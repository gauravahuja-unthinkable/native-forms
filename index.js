var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"sendCompletedForm",{enumerable:!0,get:function get(){return _nativeformsApi.sendCompletedForm}}),Object.defineProperty(exports,"NativeFormsWebView",{enumerable:!0,get:function get(){return _NativeFormsWebView.NativeFormsWebView}}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_objectSpread3=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_react=_interopRequireWildcard(require("react")),_reactNative=require("react-native"),_utils=require("./Forms/utils"),_helpers=require("./Forms/helpers"),_nativeformsApi=require("./Forms/api/nativeforms-api"),_IFrameContainer=_interopRequireDefault(require("./Forms/components/IFrameContainer")),_LoadingError=require("./Forms/components/LoadingError"),_PageLoader=require("./Forms/components/PageLoader"),_Forms=_interopRequireDefault(require("./Forms")),_MobileContainer=_interopRequireDefault(require("./Forms/components/MobileContainer")),_eventEmitter=require("./Forms/api/event-emitter"),_SelectDialog=_interopRequireDefault(require("./Forms/components/SelectField/SelectDialog")),_theme=require("./Forms/theme"),_google_analytics=require("./Forms/api/google_analytics"),_NativeFormsWebView=require("./Forms/components/NativeFormsWebView"),NativeForms=function(a){var b=a.form,c=a.formId,d=a.formJSON,e=a.onClose,f=a.onSend,g=a.email,h=a.name,i=a.extraData,j=a.predefine,k=a.onBeforeSend,l=a.noInternetConnection,m=a.forceMobile,n=(0,_objectWithoutProperties2.default)(a,["form","formId","formJSON","onClose","onSend","email","name","extraData","predefine","onBeforeSend","noInternetConnection","forceMobile"]),o=(0,_react.useState)(!1),p=(0,_slicedToArray2.default)(o,2),q=p[0],r=p[1],s=(0,_react.useState)(null),t=(0,_slicedToArray2.default)(s,2),u=t[0],v=t[1],w=(0,_react.useState)(!1),x=(0,_slicedToArray2.default)(w,2),y=x[0],z=x[1],A=(0,_utils.queryStringToJSON)(b),B=function(){return"web"===_reactNative.Platform.OS&&!A.iframe&&!n.isPreview&&!n.isTemplate&&!n.livePreview&&!n.editMode&&!m},C=function(){return"web"===_reactNative.Platform.OS&&!n.isPreview&&!n.isTemplate&&!n.livePreview&&!n.editMode};(0,_react.useEffect)(function(){(function(){var a,e,f,k,l;return _regenerator.default.async(function(m){for(;;)switch(m.prev=m.next){case 0:if(!d){m.next=3;break}try{a=d.license,v(null),d.openedAt=new Date().toString(),d.openedTimestamp=new Date().getTime(),d.license=a,(0,_utils.predefineValuesFromState)(j,d),(0,_helpers.predefineEmailAndName)(d,g,h),(0,_helpers.addExtraDataToForm)(d,i,A),(0,_eventEmitter.form_fetched)(d),B()&&(e=d.backgroundColor||_theme.colors.white,document.body.style.backgroundColor=e),C()&&(0,_google_analytics.loadGoogleAnalytics)(d),v(d)}catch(a){D(a)}return m.abrupt("return");case 3:if(f=(0,_utils.parseUrlData)(b,c),!(f.l&&f.f)){m.next=27;break}return m.prev=5,v(null),m.next=9,_regenerator.default.awrap((0,_nativeformsApi.hasOpenedForm)(f));case 9:k=m.sent,k.openedAt=new Date().toString(),k.openedTimestamp=new Date().getTime(),k.license=f.l,(0,_utils.predefineValuesFromState)(A,k),(0,_helpers.predefineEmailAndName)(k,g,h),(0,_helpers.addExtraDataToForm)(k,i,A),(0,_eventEmitter.form_fetched)(k),B()&&(l=k.backgroundColor||_theme.colors.white,document.body.style.backgroundColor=l),C()&&(0,_google_analytics.loadGoogleAnalytics)(k),v(k),m.next=25;break;case 22:m.prev=22,m.t0=m["catch"](5),D(m.t0);case 25:m.next=28;break;case 27:D("Form does not exist or link is broken");case 28:case"end":return m.stop();}},null,null,[[5,22]])})()},[b,d]),(0,_react.useEffect)(function(){u&&((0,_helpers.predefineEmailAndName)(u,g,h),v((0,_objectSpread3.default)({},u)))},[g,h]),(0,_react.useEffect)(function(){u&&(0,_helpers.addExtraDataToForm)(u,i,A)},[i]);var D=function(a){console.error(a),a.response&&409===a.response.status?z(_helpers.FORM_ALREADY_COMPLETED):a.response&&404===a.response.status?z(_helpers.FORM_NOT_FOUND):z(_helpers.FORM_ERROR)},E=_react.default.createElement(_SelectDialog.default,(0,_extends2.default)({},q,{onClose:function(){return r(!1)}})),F=function(){if(u.redirect){var a=u.redirect.url||"https://nativeforms.com",b=u.redirect.delay||1e3;B()&&window&&window.location&&setTimeout(function(){window.location.href=a},b)}f&&f()};return"web"!==_reactNative.Platform.OS||m?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_MobileContainer.default,(0,_extends2.default)({onSend:F,onBeforeSend:k,error:y,form:u,onClose:e,livePreview:A.livePreview,noInternetConnection:l,showSelectionDialog:r,forceMobile:m},n)),q&&E):A.iframe?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_IFrameContainer.default,(0,_extends2.default)({onSend:F,onBeforeSend:k,onClose:e,error:y,form:u,livePreview:A.livePreview,noInternetConnection:l,showSelectionDialog:r},n)),q&&E):y?_react.default.createElement(_LoadingError.LoadingError,{error:y}):u?_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_Forms.default,(0,_extends2.default)({livePreview:A.livePreview,form:u,onSend:F,onBeforeSend:k,noInternetConnection:l,showSelectionDialog:r},n)),q&&E):_react.default.createElement(_PageLoader.PageLoader,null)},_default=(0,_react.memo)(NativeForms);exports.default=_default;