Object.defineProperty(exports,"__esModule",{value:!0}),exports.predefineValuesFromState=predefineValuesFromState,exports.parseUrlData=parseUrlData,exports.getRandomInt=getRandomInt,exports.protectWithKey=protectWithKey,exports.queryStringToJSON=queryStringToJSON,exports.returnStateQueryParameter=returnStateQueryParameter,exports.getBrowser=getBrowser,exports.getOperatingSystem=getOperatingSystem,exports.lightOrDark=lightOrDark,exports.getDifferenceBetweenDates=getDifferenceBetweenDates,exports.returnFormValidConditions=returnFormValidConditions,exports.returnConditionStatus=returnConditionStatus,exports.isLockedUnderCondition=isLockedUnderCondition,exports.isQuestionVisible=isQuestionVisible;var _base=require("./base64"),_helpers=require("../blocks/helpers"),stringToBaseFormat=function(a){return decodeURIComponent(a.replace(/\?/g,"").toLowerCase())};function predefineValuesFromState(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=1<arguments.length?arguments[1]:void 0;if(b.pages&&"object"==typeof a){for(var c,d=Object.keys(a),e=d.length,f={};e--;)c=d[e],f[stringToBaseFormat(c)]=decodeURIComponent(a[c]);return b.pages.forEach(function(a){a.blocks&&a.blocks.forEach(function(a){"contact"===a.type&&a.value&&a.value.forEach(function(a){var b=a.question?stringToBaseFormat(a.question):"";b&&f[b]&&(a.value=f[b])});var b=a.question?stringToBaseFormat(a.question):"";b&&f[b]&&(a.value=f[b])})}),b}}function parseUrlData(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",b=1<arguments.length?arguments[1]:void 0;if(b)return(0,_base.decodeData)(b);if(!a)return{};var c=a.split("/")[3];return(c||(c=a.split("/")[1]),!c)?{}:(-1!==c.indexOf("?")&&(c=c.substring(0,c.indexOf("?"))),(0,_base.decodeData)(c))}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}function protectWithKey(a,b){var c=getRandomInt(0,a.length-1);return[a.slice(0,c),b,a.slice(c)].join("")}function queryStringToJSON(a){if(!a)return{};var b=a.split("?")[1];if(!b)return{};var c=b.split("&"),d={};return c.forEach(function(a){a=a.split("="),d[a[0]]=decodeURIComponent(a[1]||"")}),JSON.parse(JSON.stringify(d))}function returnStateQueryParameter(){var a,b=queryStringToJSON(),c=b.state;if(c)try{a=JSON.parse(decodeURIComponent(c))}catch(a){console.error("Invalid format of state query parameter.")}return a}function getBrowser(){if(!window||!window.location)return"";var a=!!window.opr&&!!window.opr.addons||!!window.opera||0<=navigator.userAgent.indexOf(" OPR/"),b="undefined"!=typeof InstallTrigger,c=/constructor/i.test(window.HTMLElement)||function(a){return"[object SafariRemoteNotification]"===a.toString()}(!window.safari||window.safari.pushNotification),d=!!document.documentMode,e=!d&&!!window.StyleMedia,f=!!window.chrome,g=(f||a)&&!!window.CSS;return a?"Opera":b?"Firefox":c?"Safari":f?"Chrome":d?"IE":e?"Edge":g?"Blink":""}function getOperatingSystem(){if(!window||!window.location)return"";var a=navigator.userAgent||navigator.vendor||window.opera;return /windows phone/i.test(a)?"Windows Phone":/android/i.test(a)?"Android":/iPad|iPhone|iPod/.test(a)&&!window.MSStream?"iOS":-1===window.navigator.userAgent.indexOf("Windows NT 10.0")?-1===window.navigator.userAgent.indexOf("Windows NT 6.2")?-1===window.navigator.userAgent.indexOf("Windows NT 6.1")?-1===window.navigator.userAgent.indexOf("Windows NT 6.0")?-1===window.navigator.userAgent.indexOf("Windows NT 5.1")?-1===window.navigator.userAgent.indexOf("Windows NT 5.0")?-1===window.navigator.userAgent.indexOf("Mac")?-1===window.navigator.userAgent.indexOf("X11")?-1===window.navigator.userAgent.indexOf("Linux")?"":"Linux":"UNIX":"Mac":"Windows 2000":"Windows XP":"Windows Vista":"Windows 7":"Windows 8":"Windows 10"}function lightOrDark(){var a,c,d,e,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return f.match(/^rgb/)?(f=f.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+(?:\.\d+)?))?\)$/),a=f[1],c=f[2],d=f[3]):(f=+("0x"+f.slice(1).replace(5>f.length&&/./g,"$&$&")),a=f>>16,c=255&f>>8,d=255&f),e=Math.sqrt(.299*(a*a)+.587*(c*c)+.114*(d*d)),127.5<e?"light":"dark"}function getDifferenceBetweenDates(a,b){var c,d;return d=Math.floor((a-b)/1e3),c=Math.floor(d/60),d%=60,c%=60,0===c?d+" seconds":c+" min "+d+" s"}function returnFormValidConditions(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=(0,_helpers.returnFormQuestions)(a).map(function(a){return a.question}),c=a.conditions||[],d=[];return c.forEach(function(a){returnConditionStatus(a,b)&&d.push(a)}),d}function returnConditionStatus(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],c=a.conditionQuestion,d=void 0===c?"":c,e=a.questionToShow,f=void 0===e?"":e,g=a.type,h=a.value;return!!(d&&f)&&!!("has any value"===g||h)&&!!b.includes(d)&&!!b.includes(f)}function isLockedUnderCondition(a,b){if(!a)return!1;if(!b||0===a.length)return!1;var c=a.filter(function(a){return a.questionToShow===b});return!!(0<c.length&&c.some(function(a){return!1===a.canShow}))}function isQuestionVisible(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=1<arguments.length?arguments[1]:void 0,c=a.conditions||[];return!(b&&0!==c.length)||!isLockedUnderCondition(c,b)}