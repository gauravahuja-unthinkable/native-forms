var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_assertThisInitialized2=_interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_react=_interopRequireWildcard(require("react")),_reactNative=require("react-native"),TimeUtil=_interopRequireWildcard(require("./time.js")),_pureRender=require("./pureRender.js"),_theme=require("../../theme"),_dataSource=require("./dataSource"),DATE_HEIGHT=40,DATE_LENGTH=10,MIDDLE_INDEX=Math.floor(DATE_LENGTH/2),MIDDLE_Y=-DATE_HEIGHT*MIDDLE_INDEX,isFunction=function(a){return"[object Function]"===Object.prototype.toString.apply(a)},DatePickerItem=function(a){function b(a){var c;return(0,_classCallCheck2.default)(this,b),c=(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(b).call(this,a)),c.touchY=0,c.translateY=0,c.currentIndex=MIDDLE_INDEX,c.moveDateCount=0,c.state={translateY:MIDDLE_Y,marginTop:(c.currentIndex-MIDDLE_INDEX)*DATE_HEIGHT},c.renderDatepickerItem=c.renderDatepickerItem.bind((0,_assertThisInitialized2.default)(c)),c.handleContentTouch=c.handleContentTouch.bind((0,_assertThisInitialized2.default)(c)),c._panResponder=_reactNative.PanResponder.create({onPanResponderTerminationRequest:function onPanResponderTerminationRequest(){return!1},onStartShouldSetPanResponder:function onStartShouldSetPanResponder(){return!0},onStartShouldSetPanResponderCapture:function onStartShouldSetPanResponderCapture(){return!0},onMoveShouldSetPanResponder:function onMoveShouldSetPanResponder(){return!0},onMoveShouldSetPanResponderCapture:function onMoveShouldSetPanResponderCapture(){return!0},onPanResponderGrant:function onPanResponderGrant(a,b){c.handleContentTouch(b,"start")},onPanResponderMove:function onPanResponderMove(a,b){c.handleContentTouch(b,"move")},onPanResponderRelease:function onPanResponderRelease(a,b){c.handleContentTouch(b,"end")},onPanResponderTerminate:function onPanResponderTerminate(a,b){c.handleContentTouch(b,"end")}}),c}return(0,_inherits2.default)(b,a),(0,_createClass2.default)(b,[{key:"componentWillMount",value:function componentWillMount(){this._iniDates(this.props.value)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(a){a.value.getTime()===this.props.value.getTime()||(this._iniDates(a.value),this.currentIndex=MIDDLE_INDEX,this.setState({translateY:MIDDLE_Y,marginTop:(this.currentIndex-MIDDLE_INDEX)*DATE_HEIGHT}))}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(a,b){return a.value.getTime()!==this.props.value.getTime()||!(0,_pureRender.shallowEqual)(b,this.state)}},{key:"_iniDates",value:function _iniDates(a){var b=this,c=this.props.type,d=Array.apply(void 0,(0,_toConsumableArray2.default)(Array(DATE_LENGTH))).map(function(d,e){return TimeUtil["next"+c](a,(e-MIDDLE_INDEX)*b.props.step)});this.setState({dates:d})}},{key:"_updateDates",value:function _updateDates(a){var b=this.props.type,c=this.state.dates;1===a?(this.currentIndex++,this.setState({dates:[].concat((0,_toConsumableArray2.default)(c.slice(1)),[TimeUtil["next"+b](c[c.length-1],this.props.step)]),marginTop:(this.currentIndex-MIDDLE_INDEX)*DATE_HEIGHT})):(this.currentIndex--,this.setState({dates:[TimeUtil["next"+b](c[0],-this.props.step)].concat((0,_toConsumableArray2.default)(c.slice(0,c.length-1))),marginTop:(this.currentIndex-MIDDLE_INDEX)*DATE_HEIGHT}))}},{key:"_checkIsUpdateDates",value:function _checkIsUpdateDates(a,b){return 1===a?this.currentIndex*DATE_HEIGHT+DATE_HEIGHT/2<-b:this.currentIndex*DATE_HEIGHT-DATE_HEIGHT/2>-b}},{key:"_moveToNext",value:function _moveToNext(a){var b=this.state.dates[MIDDLE_INDEX],c=this.props,d=c.max,e=c.min;-1===a&&b.getTime()<e.getTime()&&this.moveDateCount?this._updateDates(1):1==a&&b.getTime()>d.getTime()&&this.moveDateCount&&this._updateDates(-1),this._moveTo(this.refs.scroll,this.currentIndex)}},{key:"_moveTo",value:function _moveTo(a,b){this.props.onSelect(this.state.dates[MIDDLE_INDEX]),this.setState({translateY:-b*DATE_HEIGHT})}},{key:"handleStart",value:function handleStart(a){this.touchY=a.dy,this.translateY=this.state.translateY,this.moveDateCount=0}},{key:"handleMove",value:function handleMove(a){var b=a.dy,c=b-this.touchY,d=this.translateY+c,e=0<c?-1:1,f=this.state.dates[MIDDLE_INDEX],g=this.props,h=g.max,i=g.min;f.getTime()<i.getTime()||f.getTime()>h.getTime()||(this._checkIsUpdateDates(e,d)&&(this.moveDateCount=0<e?this.moveDateCount+1:this.moveDateCount-1,this._updateDates(e)),this.setState({translateY:d}))}},{key:"handleEnd",value:function handleEnd(a){var b=a.dy,c=b-this.touchY,d=0<c?-1:1;this._moveToNext(d)}},{key:"handleContentTouch",value:function handleContentTouch(a,b){this.props.isPreview||("start"===b?this.handleStart(a):"move"===b?this.handleMove(a):"end"==b&&this.handleEnd(a))}},{key:"renderDatepickerItem",value:function renderDatepickerItem(a,b){var c;c=isFunction(this.props.format)?this.props.format(a):TimeUtil.convertDate(a,this.props.format),"M"===this.props.format&&(c=_dataSource.MONTHS_MAP[c]);var d={color:this.props.textColor},e="web"===_reactNative.Platform.OS?{cursor:"pointer"}:{};return _react.default.createElement(_reactNative.Text,{style:[d,styles.text,e],key:b},c)}},{key:"render",value:function render(){var a={borderTopColor:this.props.isPreview?_theme.colors.buttonBorder:this.props.color,borderBottomColor:this.props.isPreview?_theme.colors.buttonBorder:this.props.color},b="web"===_reactNative.Platform.OS?{userSelect:"none"}:{};return _react.default.createElement(_reactNative.View,{style:styles.column},_react.default.createElement(_reactNative.View,(0,_extends2.default)({},this._panResponder.panHandlers,{style:styles.viewport}),_react.default.createElement(_reactNative.View,{style:[a,styles.wheel,b]},_react.default.createElement(_reactNative.View,{style:{transform:[{translateY:this.state.translateY}],marginTop:this.state.marginTop}},this.state.dates.map(this.renderDatepickerItem)))))}}]),b}(_react.Component),styles=_reactNative.StyleSheet.create({text:{height:40,lineHeight:40,fontSize:19,display:"flex",flexDirection:"column",textAlign:"center"},wheel:{position:"absolute",height:40,top:"50%",marginTop:-20,width:"100%",borderTopWidth:1,borderBottomWidth:1,borderStyle:"solid"},column:{flex:1,marginHorizontal:4},viewport:{height:200,position:"relative",overflow:"hidden"}}),_default=DatePickerItem;exports.default=_default;