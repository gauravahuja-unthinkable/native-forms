var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_react=_interopRequireWildcard(require("react")),_reactNative=require("react-native"),_statusBarHeight=require("../../utils/status-bar-height"),_Header=_interopRequireDefault(require("../Header")),_theme=require("../../theme"),_ProgressBar=_interopRequireDefault(require("../ProgressBar")),_Dimensions$get=_reactNative.Dimensions.get("window"),width=_Dimensions$get.width,height=_Dimensions$get.height,HEADER_HEIGHT=49,NativeFormsWebView=function(a){var b=a.onClose,c=a.onSend,d=a.children,e=a.extraData,f=a.name,g=a.email,h=(0,_react.useState)(!1),i=(0,_slicedToArray2.default)(h,2),j=i[0],k=i[1],l=(0,_react.useMemo)(function(){return new _reactNative.Animated.Value(0)},[]),m=(0,_react.useMemo)(function(){return new _reactNative.Animated.Value(.5)},[]),n=(0,_react.useState)({}),o=(0,_slicedToArray2.default)(n,2),p=o[0],q=o[1],r=(0,_statusBarHeight.getStatusBarHeight)(),s=(0,_extends2.default)({},d.props.source);if(s.uri){var v=s.uri;if(f&&(v+=-1<v.indexOf("?")?"&name="+f:"?name="+f),g&&(v+=-1<v.indexOf("?")?"&email="+g:"?email="+g),e&&"object"==typeof e)try{v+=-1<v.indexOf("?")?"&extraData="+JSON.stringify(e):"?extraData="+JSON.stringify(e)}catch(a){console.error("Invalid extraData prop.",a)}s.uri=v}(0,_react.useEffect)(function(){_reactNative.Animated.parallel([_reactNative.Animated.timing(l,{toValue:1,duration:500,easing:_reactNative.Easing.out(_reactNative.Easing.quad),useNativeDriver:!0}),_reactNative.Animated.timing(m,{toValue:1,duration:500,easing:_reactNative.Easing.out(_reactNative.Easing.quad),useNativeDriver:!0})]).start()},[l,m]);var t=function(){l.setValue(1),m.setValue(1),_reactNative.Animated.parallel([_reactNative.Animated.timing(l,{toValue:0,duration:300,easing:_reactNative.Easing.linear(),useNativeDriver:!0}),_reactNative.Animated.timing(m,{toValue:0,duration:300,easing:_reactNative.Easing.out(_reactNative.Easing.quad),useNativeDriver:!0})]).start(function(){b()})},u=function(a,b){k(!0),c&&c(a,b),setTimeout(function(){t()},2e3)};return _react.default.createElement(_reactNative.Animated.View,{style:[{opacity:l,transform:[{scale:m}],backgroundColor:p?p.backgroundColor||_theme.colors.white:_theme.colors.white},styles.overlay]},_react.default.createElement(_Header.default,{form:{label:p.label},onClose:t,style:{marginTop:r}}),j&&_react.default.createElement(_ProgressBar.default,{form:p}),_react.default.createElement(_reactNative.View,{style:[{height:height-HEADER_HEIGHT-r},styles.container]},d?_react.default.cloneElement(d,{onMessage:function onMessage(a){var b=a.nativeEvent;if(b.data){var e=JSON.parse(b.data);if(e.nf_event&&"form_fetched"===e.nf_event.event){var f=JSON.parse(e.nf_event.form)||{};q(f)}if(e.nf_event&&"form_send"===e.nf_event.event){var c=JSON.parse(e.nf_event.form)||{},d=JSON.parse(e.nf_event.json)||{};u(c,d)}}},source:s,style:{flex:1,width:width}}):_react.default.createElement(_reactNative.Text,null,"You forgot to provide WebView component.")))},styles=_reactNative.StyleSheet.create({overlay:{position:"web"===_reactNative.Platform.OS?"fixed":"absolute",overflow:"scroll",height:height,width:width,top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",zIndex:9e5,elevation:9},container:{alignItems:"center",justifyContent:"center",width:"100%"}});NativeFormsWebView.defaultProps={onClose:function onClose(){},onSend:function onSend(){}};var _default=(0,_react.memo)(NativeFormsWebView);exports.default=_default;