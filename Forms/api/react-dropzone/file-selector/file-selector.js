var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromEvent=fromEvent;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),tslib_1=_interopRequireWildcard(require("./tslib")),_file=require("./file"),FILES_TO_IGNORE=[".DS_Store","Thumbs.db"];function fromEvent(a){return tslib_1.__awaiter(this,void 0,void 0,_regenerator.default.mark(function b(){return _regenerator.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",isDragEvt(a)&&a.dataTransfer?getDataTransferFiles(a.dataTransfer,a.type):getInputFiles(a));case 1:case"end":return b.stop();}},b)}))}function isDragEvt(a){return!!a.dataTransfer}function getInputFiles(a){var b=isInput(a.target)?a.target.files?fromList(a.target.files):[]:[];return b.map(function(a){return(0,_file.toFileWithPath)(a)})}function isInput(a){return null!==a}function getDataTransferFiles(a,b){return tslib_1.__awaiter(this,void 0,void 0,_regenerator.default.mark(function c(){var d,e;return _regenerator.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!a.items){c.next=8;break}if(d=fromList(a.items).filter(function(a){return"file"===a.kind}),"drop"===b){c.next=4;break}return c.abrupt("return",d);case 4:return c.next=6,Promise.all(d.map(toFilePromises));case 6:return e=c.sent,c.abrupt("return",noIgnoredFiles(flatten(e)));case 8:return c.abrupt("return",noIgnoredFiles(fromList(a.files).map(function(a){return(0,_file.toFileWithPath)(a)})));case 9:case"end":return c.stop();}},c)}))}function noIgnoredFiles(a){return a.filter(function(a){return-1===FILES_TO_IGNORE.indexOf(a.name)})}function fromList(a){for(var b,c=[],d=0;d<a.length;d++)b=a[d],c.push(b);return c}function toFilePromises(a){if("function"!=typeof a.webkitGetAsEntry)return fromDataTransferItem(a);var b=a.webkitGetAsEntry();return b&&b.isDirectory?fromDirEntry(b):fromDataTransferItem(a)}function flatten(a){return a.reduce(function(a,b){return[].concat((0,_toConsumableArray2.default)(a),(0,_toConsumableArray2.default)(Array.isArray(b)?flatten(b):[b]))},[])}function fromDataTransferItem(a){var b=a.getAsFile();if(!b)return Promise.reject(a+" is not a File");var c=(0,_file.toFileWithPath)(b);return Promise.resolve(c)}function fromEntry(a){return tslib_1.__awaiter(this,void 0,void 0,_regenerator.default.mark(function b(){return _regenerator.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",a.isDirectory?fromDirEntry(a):fromFileEntry(a));case 1:case"end":return b.stop();}},b)}))}function fromDirEntry(a){var b=a.createReader();return new Promise(function(a,c){function d(){var f=this;b.readEntries(function(b){return tslib_1.__awaiter(f,void 0,void 0,_regenerator.default.mark(function f(){var g,h;return _regenerator.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(b.length){f.next=13;break}return f.prev=1,f.next=4,Promise.all(e);case 4:g=f.sent,a(g),f.next=11;break;case 8:f.prev=8,f.t0=f["catch"](1),c(f.t0);case 11:f.next=16;break;case 13:h=Promise.all(b.map(fromEntry)),e.push(h),d();case 16:case"end":return f.stop();}},f,null,[[1,8]])}))},function(a){c(a)})}var e=[];d()})}function fromFileEntry(a){return tslib_1.__awaiter(this,void 0,void 0,_regenerator.default.mark(function b(){return _regenerator.default.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt("return",new Promise(function(b,c){a.file(function(c){var d=(0,_file.toFileWithPath)(c,a.fullPath);b(d)},function(a){c(a)})}));case 1:case"end":return b.stop();}},b)}))}