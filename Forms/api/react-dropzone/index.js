var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.useDropzone=useDropzone,exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_objectSpread14=_interopRequireDefault(require("@babel/runtime/helpers/objectSpread")),_objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_react=_interopRequireWildcard(require("react")),_fileSelector=require("./file-selector"),_utils=require("./utils"),Dropzone=(0,_react.forwardRef)(function(a,b){var c=a.children,d=(0,_objectWithoutProperties2.default)(a,["children"]),e=useDropzone(d),f=e.open,g=(0,_objectWithoutProperties2.default)(e,["open"]);return(0,_react.useEffect)(function(){return"function"==typeof b?b({open:f}):"object"==typeof b&&null!==b&&(b.current={open:f}),function(){"function"==typeof b?b(null):"object"==typeof b&&null!==b&&(b.current=null)}},[b]),_react.default.createElement(_react.Fragment,null,c((0,_objectSpread14.default)({},g,{open:f})))});Dropzone.displayName="Dropzone";var _default=Dropzone;exports.default=_default;var initialState={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,draggedFiles:[],acceptedFiles:[],rejectedFiles:[]};function useDropzone(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.accept,c=a.disabled,d=void 0!==c&&c,e=a.getFilesFromEvent,f=void 0===e?_fileSelector.fromEvent:e,g=a.maxSize,h=void 0===g?1/0:g,i=a.minSize,j=void 0===i?0:i,k=a.multiple,l=!(void 0!==k)||k,m=a.onDragEnter,n=a.onDragLeave,o=a.onDragOver,p=a.onDrop,q=a.onDropAccepted,r=a.onDropRejected,s=a.onFileDialogCancel,t=a.preventDropOnDocument,u=!(void 0!==t)||t,v=a.noClick,w=void 0!==v&&v,x=a.noKeyboard,y=void 0!==x&&x,z=a.noDrag,A=void 0!==z&&z,B=a.noDragEventsBubbling,C=void 0!==B&&B,D=(0,_react.useRef)(null),E=(0,_react.useRef)(null),F=(0,_react.useReducer)(reducer,initialState),G=(0,_slicedToArray2.default)(F,2),H=G[0],I=G[1],J=H.isFocused,K=H.isFileDialogActive,L=H.draggedFiles,M=function(){E.current&&(I({type:"openDialog"}),E.current.value=null,E.current.click())},N=function(){K&&setTimeout(function(){if(E.current){var a=E.current.files;a.length||(I({type:"closeDialog"}),"function"==typeof s&&s())}},300)};(0,_react.useEffect)(function(){return window.addEventListener("focus",N,!1),function(){window.removeEventListener("focus",N,!1)}},[E,K,s]);var O=(0,_react.useCallback)(function(a){D.current&&D.current.isEqualNode(a.target)&&(32!==a.keyCode&&13!==a.keyCode||(a.preventDefault(),M()))},[D,E]),P=(0,_react.useCallback)(function(){I({type:"focus"})},[]),Q=(0,_react.useCallback)(function(){I({type:"blur"})},[]),R=(0,_react.useCallback)(function(){w||((0,_utils.isIeOrEdge)()?setTimeout(M,0):M())},[E,w]),S=(0,_react.useRef)([]),T=function(a){D.current&&D.current.contains(a.target)||(a.preventDefault(),S.current=[])};(0,_react.useEffect)(function(){return u&&(document.addEventListener("dragover",_utils.onDocumentDragOver,!1),document.addEventListener("drop",T,!1)),function(){u&&(document.removeEventListener("dragover",_utils.onDocumentDragOver),document.removeEventListener("drop",T))}},[D,u]);var U=(0,_react.useCallback)(function(a){a.preventDefault(),a.persist(),_(a),-1===S.current.indexOf(a.target)&&(S.current=[].concat((0,_toConsumableArray2.default)(S.current),[a.target])),(0,_utils.isEvtWithFiles)(a)&&Promise.resolve(f(a)).then(function(b){(0,_utils.isPropagationStopped)(a)&&!C||(I({draggedFiles:b,isDragActive:!0,type:"setDraggedFiles"}),m&&m(a))})},[f,m,C]),V=(0,_react.useCallback)(function(a){if(a.preventDefault(),a.persist(),_(a),a.dataTransfer)try{a.dataTransfer.dropEffect="copy"}catch(a){}return(0,_utils.isEvtWithFiles)(a)&&o&&o(a),!1},[o,C]),W=(0,_react.useCallback)(function(a){a.preventDefault(),a.persist(),_(a);var b=S.current.filter(function(b){return b!==a.target&&D.current&&D.current.contains(b)});S.current=b;0<b.length||(I({isDragActive:!1,type:"setDraggedFiles",draggedFiles:[]}),(0,_utils.isEvtWithFiles)(a)&&n&&n(a))},[D,n,C]),X=(0,_react.useCallback)(function(a){a.preventDefault(),a.persist(),_(a),S.current=[],I({type:"reset"}),(0,_utils.isEvtWithFiles)(a)&&Promise.resolve(f(a)).then(function(c){if(!(0,_utils.isPropagationStopped)(a)||C){var d=[],e=[];c.forEach(function(a){(0,_utils.fileAccepted)(a,b)&&(0,_utils.fileMatchSize)(a,h,j)?d.push(a):e.push(a)}),!l&&1<d.length&&e.push.apply(e,(0,_toConsumableArray2.default)(d.splice(0))),I({acceptedFiles:d,rejectedFiles:e,type:"setFiles"}),p&&p(d,e,a),0<e.length&&r&&r(e,a),0<d.length&&q&&q(d,a)}})},[l,b,j,h,f,p,q,r,C]),Y=function(a){return d?null:a},Z=function(a){return y?null:Y(a)},$=function(a){return A?null:Y(a)},_=function(a){C&&a.stopPropagation()},aa=(0,_react.useMemo)(function(){return function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=a.refKey,c=void 0===b?"ref":b,e=a.onKeyDown,f=a.onFocus,g=a.onBlur,h=a.onClick,i=a.onDragEnter,j=a.onDragOver,k=a.onDragLeave,l=a.onDrop,m=(0,_objectWithoutProperties2.default)(a,["refKey","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"]);return(0,_objectSpread14.default)((0,_defineProperty2.default)({onKeyDown:Z((0,_utils.composeEventHandlers)(e,O)),onFocus:Z((0,_utils.composeEventHandlers)(f,P)),onBlur:Z((0,_utils.composeEventHandlers)(g,Q)),onClick:Y((0,_utils.composeEventHandlers)(h,R)),onDragEnter:$((0,_utils.composeEventHandlers)(i,U)),onDragOver:$((0,_utils.composeEventHandlers)(j,V)),onDragLeave:$((0,_utils.composeEventHandlers)(k,W)),onDrop:$((0,_utils.composeEventHandlers)(l,X))},c,D),d||y?{}:{tabIndex:0},{},m)}},[D,O,P,Q,R,U,V,W,X,y,A,d]),ba=(0,_react.useCallback)(function(a){a.stopPropagation()},[]),ca=(0,_react.useMemo)(function(){return function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=a.refKey,d=void 0===c?"ref":c,e=a.onChange,f=a.onClick,g=(0,_objectWithoutProperties2.default)(a,["refKey","onChange","onClick"]),h=(0,_defineProperty2.default)({accept:b,multiple:l,type:"file",style:{display:"none"},onChange:Y((0,_utils.composeEventHandlers)(e,X)),onClick:Y((0,_utils.composeEventHandlers)(f,ba)),autoComplete:"off",tabIndex:-1},d,E);return(0,_objectSpread14.default)({},h,{},g)}},[E,b,l,X,d]),da=L.length,ea=0<da&&(0,_utils.allFilesAccepted)(L,b);return(0,_objectSpread14.default)({},H,{isDragAccept:ea,isDragReject:0<da&&(!ea||!(l||1>=da)),isFocused:J&&!d,getRootProps:aa,getInputProps:ca,rootRef:D,inputRef:E,open:Y(M)})}function reducer(a,b){switch(b.type){case"focus":return(0,_objectSpread14.default)({},a,{isFocused:!0});case"blur":return(0,_objectSpread14.default)({},a,{isFocused:!1});case"openDialog":return(0,_objectSpread14.default)({},a,{isFileDialogActive:!0});case"closeDialog":return(0,_objectSpread14.default)({},a,{isFileDialogActive:!1});case"setDraggedFiles":var c=b.isDragActive,d=b.draggedFiles;return(0,_objectSpread14.default)({},a,{draggedFiles:d,isDragActive:c});case"setFiles":return(0,_objectSpread14.default)({},a,{acceptedFiles:b.acceptedFiles,rejectedFiles:b.rejectedFiles});case"reset":return(0,_objectSpread14.default)({},a,{isFileDialogActive:!1,isDragActive:!1,draggedFiles:[]});default:return a;}}