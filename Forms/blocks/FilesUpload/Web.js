var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_react=_interopRequireWildcard(require("react")),_reactNative=require("react-native"),_reactDropzone=require("../../api/react-dropzone"),_theme=require("../../theme"),_icons=require("../../assets/icons"),_FilePreview=_interopRequireDefault(require("../../components/FilePreview")),_QuestionHeader=_interopRequireDefault(require("../../components/QuestionHeader")),_config=require("../../config"),_utils=require("../../utils"),_FadeInView=_interopRequireDefault(require("../../components/FadeInView")),_Dimensions$get=_reactNative.Dimensions.get("window"),width=_Dimensions$get.width,FilesUpload=function(a){var b=a.block,c=a.form,d=a.isPreview,e=a.currentPageIndex,f=a.blockIndex,g=a.allBlocks,h=a.onFormValueChange,i=(0,_react.useState)(!1),j=(0,_slicedToArray2.default)(i,2),k=j[0],l=j[1],m=(0,_react.useState)(b.files||[]),n=(0,_slicedToArray2.default)(m,2),o=n[0],p=n[1],q=b.accept,r=c.backgroundColor,s=void 0===r?_theme.colors.white:r,t=(0,_utils.lightOrDark)(s),u=function(a){var c=o.filter(function(b){return b.name!==a.name});b.files=b.files.filter(function(b){return b.name!==a.name}),b.value=v(c.length),h&&h(b),p(c),l(!1)},v=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;if(0>=a)return"";var b=1===a?"file":"files";return"Uploaded "+a+" "+b};(0,_react.useEffect)(function(){return function(){o.forEach(function(a){return URL.revokeObjectURL(a.preview)})}},[o]);var w=(0,_reactDropzone.useDropzone)({onDrop:function onDrop(a,c){0<c.length?l(0<c.filter(function(a){return 0>a.type.indexOf("image")}).length?"Sorry, you can only upload images.":"File exceeded max 5mb size."):l(!1),o.length+a.length>_config.config.MAX_UPLOAD_FILES_NUMBER&&l("Files limit reached. Max "+_config.config.MAX_UPLOAD_FILES_NUMBER+" files.");var d=[].concat((0,_toConsumableArray2.default)(o),(0,_toConsumableArray2.default)(a.map(function(a){return(0,_extends2.default)(a,{preview:URL.createObjectURL(a)})}))).slice(0,_config.config.MAX_UPLOAD_FILES_NUMBER);b.files=b.files||[],d.forEach(function(a,c){if(!(b.files[c]&&b.files[c].name===a.name)){var d=new FileReader;d.readAsDataURL(a),d.onloadend=function(){b.files[c]={name:a.name,type:a.type,base64:d.result}}}}),b.value=v(d.length),h&&h(b),p(d)},noKeyboard:!0,disabled:d,multiple:!0,accept:q||"",maxSize:5e6}),x=w.getRootProps,y=w.getInputProps,z=w.isDragActive,A={cursor:d?"auto":"pointer",flexDirection:0<o.length?"row":"column",justifyContent:0<o.length?"flex-start":"center",backgroundColor:z?_theme.colors.success+"10":s,borderWidth:1,borderStyle:"solid",borderColor:z?_theme.colors.success:"dark"===t?_theme.colors.darkgrey:_theme.colors.border,position:"relative",display:"flex",alignItems:"center",flexWrap:"wrap",minHeight:150,padding:500>=width?16:24,boxSizing:"border-box",width:"100%",borderRadius:4},B={fontSize:13,color:z?_theme.colors.add:"dark"===t?_theme.colors.white:_theme.colors.darkgrey,paddingTop:8,textAlign:"center"};return _react.default.createElement(_FadeInView.default,null,_react.default.createElement(_QuestionHeader.default,{form:c,block:b,currentPageIndex:e,blockIndex:f,allBlocks:g}),_react.default.createElement(_reactNative.View,{style:styles.inputContainer},_react.default.createElement("div",(0,_extends2.default)({style:A},x(),{className:"dropZone"}),_react.default.createElement("input",(0,_extends2.default)({style:{display:"none",position:"absolute",width:0,height:0}},y())),o.map(function(a,b){return _react.default.createElement(_FilePreview.default,{removeFile:u,isPreview:d,file:a,key:a.name+b})}),0===o.length&&_react.default.createElement(_react.Fragment,null,_react.default.createElement(_icons.UploadIcon,{size:32}),_react.default.createElement(_reactNative.Text,{style:B},"Drop your files here or click to browse"))),k&&_react.default.createElement(_reactNative.Text,{style:styles.error},k)))},styles=_reactNative.StyleSheet.create({inputContainer:{display:"flex",width:"100%",backgroundColor:"transparent",alignItems:"flex-start",maxWidth:_theme.MAX_FORM_WIDTH,paddingHorizontal:22,paddingVertical:24},error:{fontSize:14,color:_theme.colors.error,paddingVertical:8,paddingHorizontal:4}}),_default=(0,_react.memo)(FilesUpload);exports.default=_default;