var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.clearFormValues=clearFormValues,exports.clearBlock=clearBlock,exports.getTypeLabel=getTypeLabel,exports.returnBlockValue=returnBlockValue,exports.returnPageCompletionStatus=returnPageCompletionStatus,exports.returnQuestionsCount=returnQuestionsCount,exports.getDefaultBadge=getDefaultBadge,exports.renderBlocks=renderBlocks,exports.returnFormQuestions=returnFormQuestions,exports.renderBlock=exports.returnFormData=exports.returnQuestionNumber=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray")),_react=_interopRequireDefault(require("react")),_reactNative=require("react-native"),_Description=_interopRequireDefault(require("./Description")),_Open=_interopRequireDefault(require("./Open")),_SingleSelection=_interopRequireDefault(require("./SingleSelection")),_MultiSelection=_interopRequireDefault(require("./MultiSelection")),_NumberScale=_interopRequireDefault(require("./NumberScale")),_Stars=_interopRequireDefault(require("./Stars")),_Contact=_interopRequireDefault(require("./Contact")),_Web=_interopRequireDefault(require("./FilesUpload/Web")),_Mobile=_interopRequireDefault(require("./FilesUpload/Mobile")),_Date=_interopRequireDefault(require("./Date")),_Image=_interopRequireDefault(require("./Image")),_utils=require("../utils");function clearFormValues(a){var b=a.pages||[];b.forEach(function(a){var b=a.blocks||[];b.forEach(function(a){return clearBlock(a)})})}function clearBlock(a){Array.isArray(a.value)?a.value[0]&&(a.value[0].type||a.value[0].question)?a.value.forEach(function(a){a.value&&(a.value="")}):0<a.value.length&&(a.value=[]):(a.value&&(a.value=""),a.files&&delete a.files,a.time&&delete a.time,a.timezone&&delete a.timezone)}function getTypeLabel(a){return"contact"===a?"Fields":"files"===a?"File Upload":"date"===a?"Date Picker":"open"===a?"Open-ended":"number-scale"===a?"Net Promoter Score":"single-selection"===a?"Single-selection":"stars"===a?"Stars":"multi-selection"===a?"Multiple-selection":"description"===a?"Description":"image"===a?"Image / Photo / GIF":a}var returnQuestionNumber=function(a,b,c){for(var d=a+1,e=0;e<b;e++)d+=c[e].blocks.length;return d};exports.returnQuestionNumber=returnQuestionNumber;var returnFormData=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.pages||[],c={};return b.forEach(function(b){var d=b.blocks||[];d.forEach(function(b){if("contact"===b.type){var g=b.value||[];return void g.forEach(function(b){var d=returnBlockValue(b,a),e=d.value,f=d.canSend;e&&f&&(c[b.question]=e)})}var d=returnBlockValue(b,a),e=d.value,f=d.canSend;e&&f&&(c[b.question]=e)})}),a.extraData&&Object.keys(a.extraData).forEach(function(b){return"string"==typeof a.extraData[b]?void(c[b]=a.extraData[b]):void console.error(b+" has invalid data format. Should be string.")}),c};exports.returnFormData=returnFormData;function returnBlockValue(a,b){if(Array.isArray(a.value)){if(a.value[0]&&(a.value[0].type||a.value[0].question)){var c=!0;return a.value.forEach(function(a){(0,_utils.isQuestionVisible)(b,a.question)&&(!a.isRequired||a.value||(c=!1))}),{value:a.value.filter(function(a){return a.value}).map(function(a){return"\n"+a.question+": "+a.value}).join(", "),canSend:c}}return a.value=a.value.filter(function(a){return a}),{canSend:!(0,_utils.isQuestionVisible)(b,a.question)||!a.isRequired||0<a.value.length,value:a.value.join(", ")}}return{canSend:!(0,_utils.isQuestionVisible)(b,a.question)||!a.isRequired||a.value,value:a.value}}function returnPageCompletionStatus(a,b){var c=a.blocks||[],d=!0,e=!1;return c.forEach(function(a){var c=returnBlockValue(a,b),f=c.canSend,g=c.value;!e&&g&&(e=!0),f||(d=!1)}),{isCompleted:d,hasValues:e}}function returnQuestionsCount(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],b=0;return a.forEach(function(a){a.blocks&&a.blocks.forEach(function(a){if("contact"===a.type){var c=a.value||[];return void(b+=c.length)}b+=1})}),b}function getDefaultBadge(a,b){if(!1===a)return!1;if(a)return a;return"contact"===b?"FILL IN FIELDS BELOW":"files"===b?"DROP FILES IN THE BOX BELOW":"date"===b?"SELECT DATE":"open"===b?"WRITE IN THE BOX BELOW":"number-scale"===b?"PICK NUMBER":"single-selection"===b?"SELECT ONE":"stars"===b?"TAP STARS TO RATE":"multi-selection"===b?"SELECT ONE OR MORE":""}function renderBlocks(a){var b=a.page,c=a.form,d=a.isPreview,e=a.currentPageIndex,f=a.onFocus,g=a.onBlur,h=a.showSelectionDialog,i=a.conditions,j=a.onFormValueChange,k=c.pages||[],l=[];k.forEach(function(a){return l.push.apply(l,(0,_toConsumableArray2.default)(a.blocks))});var m=b.blocks||[];return m.map(function(a,k){a.badge=getDefaultBadge(a.badge,a.type);var m={form:c,block:a,page:b,isPreview:d,currentPageIndex:e,blockIndex:k,allBlocks:l,onFocus:f,onBlur:g,showSelectionDialog:h,conditions:i,onFormValueChange:j,key:a.type+e+"block"+k};return renderBlock(a,m)})}var renderBlock=function(a,b){if((0,_utils.isLockedUnderCondition)(b.conditions,a.question))return null;switch(a.type){case"image":return _react.default.createElement(_Image.default,b);case"description":return _react.default.createElement(_Description.default,b);case"number-scale":return _react.default.createElement(_NumberScale.default,b);case"stars":return _react.default.createElement(_Stars.default,b);case"contact":return _react.default.createElement(_Contact.default,b);case"open":return _react.default.createElement(_Open.default,b);case"single-selection":return _react.default.createElement(_SingleSelection.default,b);case"multi-selection":return _react.default.createElement(_MultiSelection.default,b);case"date":return _react.default.createElement(_Date.default,b);case"files":return"web"===_reactNative.Platform.OS?_react.default.createElement(_Web.default,b):_react.default.createElement(_Mobile.default,b);default:return null;}};exports.renderBlock=renderBlock;function returnFormQuestions(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},b=a.pages||[],c=[];return b.forEach(function(a){var b=a.blocks||[];b.forEach(function(a){if("contact"===a.type){var b=a.value||[];return void b.forEach(function(a){c.push(a)})}c.push(a)})}),c}